name: build Gmeek

on:
  workflow_dispatch:  # 手动触发
  issues:
    types: [opened, edited]  # Issue 触发
  schedule:
    - cron: "0 16 * * *"  # 定时触发（每天 UTC 16:00 = 北京时间 00:00）
    
jobs:
  build:
    name: Generate blog
    runs-on: ubuntu-24.04
    if: ${{ github.event.repository.owner.id == github.event.sender.id || github.event_name == 'schedule' }}
    permissions: write-all
    steps:
      - name: Checkout 本仓库代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: 安装系统依赖（jq + 构建工具）
        run: |
          sudo apt-get update && sudo apt-get install -y jq
          echo "====== 检查核心文件 ======"
          # 检查必需文件是否存在
          required_files=("Gmeek.py" "config.json" "requirements.txt" "templates/plist.html" "templates/post.html")
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "❌ 缺失必需文件：$file"
              exit 1
            fi
          done
          echo "✅ 所有核心文件存在"

      - name: 配置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: 3.8

      - name: 安装 Python 依赖
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: 生成博客文件
        run: |
          echo "====== 开始执行 Gmeek 生成脚本 ======"
          # 处理 issue_number（为空时传空字符串）
          ISSUE_NUM="${{ github.event.issue.number || '' }}"
          if [ -z
